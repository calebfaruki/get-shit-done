---
phase: 03-knowledge-document-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/knowledge/execution-domain.md
  - get-shit-done/knowledge/verification-domain.md
autonomous: true
requirements: [KNOW-04, KNOW-05, KNOW-06]

must_haves:
  truths:
    - "Execution domain doc exists with TDD flow, deviation rules, and tool guidance"
    - "Verification domain doc exists with goal-backward verification, stub detection, and staging rules"
    - "Both docs are under 10,000 tokens each"
    - "Both docs include explicit tool guidance for native Claude Code tools"
    - "Deviation rules from executor agent are faithfully captured (Rules 1-4, fix attempt limit, scope boundary)"
    - "Stub detection patterns from verification-patterns.md are migrated with tool guidance updates"
  artifacts:
    - path: "get-shit-done/knowledge/execution-domain.md"
      provides: "Execution domain knowledge (TDD, deviations, tool guidance)"
      contains: "deviation"
    - path: "get-shit-done/knowledge/verification-domain.md"
      provides: "Verification domain knowledge (goal-backward, stubs, staging)"
      contains: "stub"
  key_links:
    - from: "get-shit-done/knowledge/execution-domain.md"
      to: "references/tdd.md content"
      via: "migrated TDD methodology"
      pattern: "RED.*GREEN.*REFACTOR|red-green-refactor"
    - from: "get-shit-done/knowledge/execution-domain.md"
      to: "agents/gsd-executor.md deviation rules"
      via: "extracted deviation rules"
      pattern: "Rule 1|Rule 2|Rule 3|Rule 4"
    - from: "get-shit-done/knowledge/verification-domain.md"
      to: "references/verification-patterns.md content"
      via: "migrated verification patterns"
      pattern: "stub_detection|TODO|FIXME"
---

<objective>
Create execution domain and verification domain knowledge documents that agents reason over instead of rigid workflow scripts.

Purpose: Migrate proven TDD methodology, deviation rules, verification patterns, and staging rules from existing reference files and agent instructions into focused knowledge documents. These are the two heavier domains with more source material to extract from.

Output: Two knowledge documents in `get-shit-done/knowledge/` — one for execution domain, one for verification domain.
</objective>

<execution_context>
@/Users/calebfaruki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/calebfaruki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@get-shit-done/references/tdd.md
@get-shit-done/references/verification-patterns.md
@get-shit-done/agents/gsd-executor.md
@get-shit-done/agents/gsd-verifier.md
@SPEC.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create execution domain knowledge document</name>
  <files>get-shit-done/knowledge/execution-domain.md</files>
  <action>
Create `get-shit-done/knowledge/execution-domain.md`.

Extract and adapt content from three sources:
1. **tdd.md** (references/) — migrate the TDD methodology. Keep: overview, when_to_use_tdd, execution_flow (red-green-refactor), test_quality, error_handling. Adapt: remove commit instructions per SPEC.md (executor no longer commits per step — changes remain unstaged). Keep context_budget section (40% target for TDD plans).
2. **gsd-executor.md** (agents/) — extract deviation rules section. All four rules with their triggers, examples, and processes. Include the fix attempt limit (max 3 attempts per issue, then stop and report). Include scope boundary rule (deviations must stay within planned scope). These transfer unchanged per SPEC.md: "Transfers from GSD unchanged: Deviation rules (Rules 1-4, scope boundary, fix attempt limit)."
3. **Tool guidance** — explicit native tool usage for execution operations.

Structure the document with these sections:
- Brief overview (~5 lines) stating purpose and when agents load this doc
- `<tdd_flow>` section: the TDD methodology from tdd.md. When to use TDD (candidates vs skip). Red-green-refactor cycle. Test quality principles. Error handling. Context budget (40% for TDD). Adapt commit instructions: instead of "commit after each phase", note that executor tracks changes but does not commit (changes remain unstaged for verifier).
- `<deviation_rules>` section: Rules 1-4 from gsd-executor.md. For each rule: trigger condition, examples, process/action. Rule 1 (auto-fix bugs), Rule 2 (auto-add critical missing functionality), Rule 3 (auto-fix blocking issues), Rule 4 (stop for architectural changes — user decision required). Fix attempt limit: max 3 attempts, then stop. Scope boundary: deviations stay within planned scope.
- `<tool_guidance>` section: native tools for execution operations. Bash for running tests (`node --test`, `npm test`, etc.). Read for loading plan and context files. Write/Edit for creating/modifying source files. Grep for finding patterns in codebase. NEVER use gsd-tools.cjs commands.

Target: 350-500 lines (~3-4K tokens). Do NOT exceed 650 lines.

Do NOT include orchestration (how executor is spawned, what it reads first). That belongs in Phase 4/5.
Do NOT duplicate planning content — TDD detection heuristic lives in planning domain. This doc covers TDD execution once a TDD plan is created.
  </action>
  <verify>
1. File exists: `ls get-shit-done/knowledge/execution-domain.md`
2. Has required sections: grep for `<tdd_flow>`, `<deviation_rules>`, `<tool_guidance>`
3. Token estimate: `wc -w get-shit-done/knowledge/execution-domain.md` — should be under 7500 words (10K tokens)
4. Deviation rules complete: grep for "Rule 1" "Rule 2" "Rule 3" "Rule 4" all match
5. Fix attempt limit present: grep for "3 attempts" or "three attempts" matches
6. No commit instructions in TDD flow: grep for "git commit" should return 0 matches (executor does not commit)
  </verify>
  <done>execution-domain.md exists in knowledge/ with TDD flow, deviation rules (1-4 with fix attempt limit), and tool guidance, all under 10K tokens, with no commit instructions</done>
</task>

<task type="auto">
  <name>Task 2: Create verification domain knowledge document</name>
  <files>get-shit-done/knowledge/verification-domain.md</files>
  <action>
Create `get-shit-done/knowledge/verification-domain.md`.

Extract and adapt content from three sources:
1. **verification-patterns.md** (references/) — migrate stub detection patterns and verification checklists. Adapt all bash grep/find examples to use native Grep/Glob tools instead. The core_principle, stub_detection, wiring_verification, verification_checklist, and human_verification_triggers sections contain proven patterns. Drop React/Next.js/Prisma-specific sections (react_components, api_routes, database_schema, hooks_utilities, environment_config) — these are framework-specific and not domain knowledge for a framework-agnostic tool. Keep the universal patterns.
2. **gsd-verifier.md** (agents/) — extract goal-backward verification methodology: checking truths against actual implementation, artifact substantiveness checks, wiring verification. Extract the report-only principle: verifier reports diagnostics and stops on fail, stages on pass. No automated fix loops per SPEC.md.
3. **Staging rules from SPEC.md** — explicit `git add <file>` only (never `git add -A` or `git add .`). Working tree safety: pipeline manages `.planning/` files only. Verifier stages executor's changed files on pass.

Structure the document with these sections:
- Brief overview (~5 lines) stating purpose and when agents load this doc
- `<verification_methodology>` section: the core principle (existence != implementation — exists, substantive, wired, functional). Goal-backward verification: check truths from must_haves against actual code. Report-only: diagnose and report, never auto-fix. On pass: stage files. On fail: write diagnostics.
- `<stub_detection>` section: universal stub patterns from verification-patterns.md. Comment-based stubs (TODO, FIXME, placeholder). Empty implementations (return null, pass). Hardcoded values. Adapt ALL grep examples to use native Grep tool. Include the wiring verification patterns (component→API, API→database, form→handler, state→render) in universal form.
- `<staging_rules>` section: git staging safety from SPEC.md. Always `git add <file>` via Bash (explicit files only). NEVER `git add -A` or `git add .`. Working tree safety: manage `.planning/` files only. Never commit, reset, checkout, stash, or discard working tree content. Two views for human: `git diff` (current unstaged) and `git diff --cached` (all verified/staged).
- `<tool_guidance>` section: native tools for verification operations. Grep for stub detection patterns (NEVER bash grep). Glob for finding files to verify. Read for checking file content. Bash only for `git add`, `git status`, `git diff`. Write for creating verification reports.

Target: 350-500 lines (~3-5K tokens). Do NOT exceed 650 lines.

Do NOT include framework-specific verification patterns (React, Prisma, Express). Keep patterns universal and applicable to any codebase.
Do NOT include automated fix loops or gap-closure logic. Verifier reports and stops.
  </action>
  <verify>
1. File exists: `ls get-shit-done/knowledge/verification-domain.md`
2. Has required sections: grep for `<verification_methodology>`, `<stub_detection>`, `<staging_rules>`, `<tool_guidance>`
3. Token estimate: `wc -w get-shit-done/knowledge/verification-domain.md` — should be under 7500 words (10K tokens)
4. Staging safety present: grep for "git add" and "NEVER.*git add -A" both match
5. Report-only principle: grep for "report" and "stop" should match; grep for "auto.*fix" or "gap.*closure" should return 0 matches
6. No bash grep instructions: grep for 'grep -E' outside of "NEVER" examples should return 0 matches (all patterns use Grep tool)
  </verify>
  <done>verification-domain.md exists in knowledge/ with verification methodology, universal stub detection, staging rules, and tool guidance, all under 10K tokens, report-only with no fix loops</done>
</task>

</tasks>

<verification>
- [ ] `ls get-shit-done/knowledge/execution-domain.md get-shit-done/knowledge/verification-domain.md` — both files exist
- [ ] `wc -w get-shit-done/knowledge/*.md` — each file under 7500 words
- [ ] Execution domain has all 4 deviation rules with fix attempt limit
- [ ] Verification domain has staging safety rules (explicit git add only)
- [ ] Both files have `<tool_guidance>` sections with native tool references
- [ ] No framework-specific patterns (React, Prisma, Express) in verification domain
- [ ] No commit instructions in execution domain TDD section
</verification>

<success_criteria>
- Execution domain doc covers TDD flow (adapted for no-commit executor), deviation rules (1-4), and tool guidance
- Verification domain doc covers goal-backward verification, universal stub detection, staging rules, and tool guidance
- Both docs are well under 10K tokens (target 3-5K each)
- Deviation rules faithfully captured from executor agent (unchanged per SPEC.md)
- Stub detection patterns migrated from verification-patterns.md with native tool guidance
- No orchestration, framework-specific, or fix-loop content leaked into knowledge docs
</success_criteria>

<output>
After completion, create `.planning/phases/03-knowledge-document-system/03-02-SUMMARY.md`
</output>
