---
phase: 04-command-handlers-and-project-lifecycle
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - commands/map.md
  - commands/todo.md
  - get-shit-done/workflows/map-codebase.md
  - get-shit-done/workflows/check-todos.md
  - commands/gsd/map-codebase.md
  - commands/gsd/check-todos.md
autonomous: true
requirements: [CLN-04, CMD-11, CMD-12, STATE-05]

must_haves:
  truths:
    - "`.planning/` is in `.gitignore` so ephemeral state is never committed"
    - "User can run `/map` (bare namespace) to produce a codebase map anchored to commit SHA"
    - "User can run `/todo` (bare namespace) to list parking lot items with optional area filtering"
    - "Old `/gsd:map-codebase` and `/gsd:check-todos` commands no longer exist"
    - "No session state is created or consulted — files on disk are the state"
  artifacts:
    - path: ".gitignore"
      provides: "`.planning/` exclusion from git tracking"
      contains: ".planning/"
    - path: "commands/map.md"
      provides: "Bare namespace `/map` command entry point"
      contains: "name: map"
    - path: "commands/todo.md"
      provides: "Bare namespace `/todo` command entry point"
      contains: "name: todo"
  key_links:
    - from: "commands/map.md"
      to: "get-shit-done/workflows/map-codebase.md"
      via: "execution_context reference"
      pattern: "workflows/map-codebase"
    - from: "commands/todo.md"
      to: "get-shit-done/workflows/check-todos.md"
      via: "execution_context reference"
      pattern: "workflows/check-todos"
---

<objective>
Establish the infrastructure for Phase 4: add `.planning/` to `.gitignore`, create the first bare-namespace commands (`/map` and `/todo`), and delete their `gsd:*` predecessors.

Purpose: Foundation that all subsequent plans depend on — `.gitignore` prevents accidental commits of ephemeral state, and the two utility commands prove the namespace transition pattern.
Output: Working `/map` and `/todo` commands under bare namespace, `.planning/` gitignored.
</objective>

<execution_context>
@/Users/calebfaruki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/calebfaruki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@SPEC.md (sections 3, 4, 5 — command surface, file structure)
@.planning/phases/04-command-handlers-and-project-lifecycle/04-CONTEXT.md
@commands/gsd/map-codebase.md
@commands/gsd/check-todos.md
@get-shit-done/workflows/map-codebase.md
@get-shit-done/workflows/check-todos.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add .planning/ to .gitignore and create bare-namespace /map command</name>
  <files>.gitignore, commands/map.md, get-shit-done/workflows/map-codebase.md, commands/gsd/map-codebase.md</files>
  <action>
  1. Add `.planning/` to `.gitignore` if not already present. This is the first thing done in Phase 4 per CONTEXT.md decision.

  2. Create `commands/map.md` as the bare-namespace command file. Use the same frontmatter pattern as existing `commands/gsd/map-codebase.md` but:
     - `name: map` (not `gsd:map-codebase`)
     - Keep `description`, `allowed-tools` from existing
     - Reference workflow via `<execution_context>@~/.claude/get-shit-done/workflows/map-codebase.md</execution_context>`
     - Update objective text to match SPEC section 4: "Analyze the codebase, anchored to current commit SHA"
     - Remove any references to STATE.md, ROADMAP.md, config.json, or other GSD-specific state

  3. Modify `get-shit-done/workflows/map-codebase.md`:
     - Add commit SHA anchoring: workflow should store the SHA used for mapping in the output CODEBASE.md file
     - Output goes to `.planning/CODEBASE.md` (single file, semi-durable) per SPEC section 5
     - Strip any references to STATE.md, ROADMAP.md, config.json
     - Remove any auto-advance or next-step automation
     - Handoff message should suggest `/new-project` as next step (per SPEC hierarchy)
     - Keep `gsd-tools.cjs init map-codebase` and `resolve-model` calls (survivors per CONTEXT)

  4. Delete `commands/gsd/map-codebase.md` — no coexistence period per CONTEXT decision.
  </action>
  <verify>
  - `grep -q '.planning/' .gitignore` confirms gitignore entry
  - `test -f commands/map.md` confirms new command exists
  - `grep 'name: map' commands/map.md` confirms bare namespace
  - `test ! -f commands/gsd/map-codebase.md` confirms old command deleted
  - No references to STATE.md or ROADMAP.md in commands/map.md or workflows/map-codebase.md
  </verify>
  <done>`.planning/` is gitignored, `/map` command works with bare namespace, old `/gsd:map-codebase` deleted, codebase map output anchored to commit SHA</done>
</task>

<task type="auto">
  <name>Task 2: Create bare-namespace /todo command and clean up remaining gsd:* command deletions</name>
  <files>commands/todo.md, get-shit-done/workflows/check-todos.md, commands/gsd/check-todos.md</files>
  <action>
  1. Create `commands/todo.md` as the bare-namespace command file:
     - `name: todo`
     - `description: View parking lot items. Lists all todos; optionally filter by area.`
     - This is a main conversation command (not subagent) per SPEC section 3
     - `allowed-tools: [Read, Bash, Glob, Grep]` — lightweight, no Write needed for viewing
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/check-todos.md</execution_context>`
     - Update objective to match SPEC: list files in `.planning/todos/` showing area and summary
     - Remove any GSD-specific state references

  2. Modify `get-shit-done/workflows/check-todos.md`:
     - Ensure it reads from `.planning/todos/*.md` (correct per SPEC section 5)
     - Display area tag and summary for each todo
     - Support optional area filter argument (e.g., `/todo payments`)
     - Strip any references to STATE.md, ROADMAP.md, requirements tracking
     - No todo creation — this command only views (creation happens in `/new-project` and `/plan-project`)
     - No "complete" or "delete" functionality — human manages lifecycle per SPEC

  3. Delete `commands/gsd/check-todos.md` — no coexistence period.

  4. If `commands/gsd/` directory is now empty (all files deleted across Phase 1 and this plan), remove the directory itself. If other files remain, leave them for subsequent plans to handle.
  </action>
  <verify>
  - `test -f commands/todo.md` confirms new command exists
  - `grep 'name: todo' commands/todo.md` confirms bare namespace
  - `test ! -f commands/gsd/check-todos.md` confirms old command deleted
  - No references to STATE.md, ROADMAP.md, REQUIREMENTS.md in todo command or workflow
  </verify>
  <done>`/todo` command works with bare namespace showing todos from `.planning/todos/`, old `/gsd:check-todos` deleted, no session state consulted</done>
</task>

</tasks>

<verification>
- [ ] `.planning/` appears in `.gitignore`
- [ ] `commands/map.md` exists with `name: map`
- [ ] `commands/todo.md` exists with `name: todo`
- [ ] `commands/gsd/map-codebase.md` does not exist
- [ ] `commands/gsd/check-todos.md` does not exist
- [ ] Neither command references STATE.md, ROADMAP.md, or config.json
- [ ] Workflow files updated to use `.planning/CODEBASE.md` and `.planning/todos/`
</verification>

<success_criteria>
- `.planning/` is gitignored
- `/map` and `/todo` work under bare namespace
- Old `gsd:*` versions are deleted
- No session state or persistent GSD artifacts referenced
</success_criteria>

<output>
After completion, create `.planning/phases/04-command-handlers-and-project-lifecycle/04-01-SUMMARY.md`
</output>
