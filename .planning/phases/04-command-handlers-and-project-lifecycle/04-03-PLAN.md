---
phase: 04-command-handlers-and-project-lifecycle
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - commands/research-project.md
  - commands/plan-project.md
  - commands/verify-project.md
  - get-shit-done/workflows/research-project.md
  - get-shit-done/workflows/plan-project.md
  - get-shit-done/workflows/verify-project.md
autonomous: true
requirements: [CMD-02, CMD-04, CMD-05, STATE-02]

must_haves:
  truths:
    - "User can run `/research-project` to spawn a research subagent that writes PROJECT-RESEARCH.md"
    - "User can run `/plan-project` to spawn a planning subagent that breaks project into phases and writes PROJECT-PLAN.md"
    - "User can run `/verify-project` to check final result against project acceptance criteria"
    - "PROJECT-PLAN.md is the sole planning artifact — no ROADMAP.md, STATE.md, or MILESTONES.md created"
    - "All three commands check prerequisites and warn (not hard block) if missing"
  artifacts:
    - path: "commands/research-project.md"
      provides: "Bare namespace `/research-project` command"
      contains: "name: research-project"
    - path: "commands/plan-project.md"
      provides: "Bare namespace `/plan-project` command"
      contains: "name: plan-project"
    - path: "commands/verify-project.md"
      provides: "Bare namespace `/verify-project` command"
      contains: "name: verify-project"
    - path: "get-shit-done/workflows/plan-project.md"
      provides: "Planning workflow producing PROJECT-PLAN.md"
      contains: "PROJECT-PLAN.md"
  key_links:
    - from: "commands/research-project.md"
      to: "get-shit-done/workflows/research-project.md"
      via: "execution_context reference"
      pattern: "workflows/research-project"
    - from: "get-shit-done/workflows/plan-project.md"
      to: ".planning/project/PROJECT-PLAN.md"
      via: "output artifact"
      pattern: "PROJECT-PLAN\\.md"
    - from: "get-shit-done/workflows/verify-project.md"
      to: ".planning/project/PROJECT.md"
      via: "reads acceptance criteria"
      pattern: "PROJECT\\.md"
---

<objective>
Build the three project-level subagent commands: `/research-project` (strategic research), `/plan-project` (phase breakdown), and `/verify-project` (acceptance criteria verification).

Purpose: These commands complete the project-level lifecycle. Research informs discussion, planning breaks the project into executable phases, verification closes the loop.
Output: Three working commands with workflows, all writing to `.planning/project/`.
</objective>

<execution_context>
@/Users/calebfaruki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/calebfaruki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@SPEC.md (sections 3, 4 — /research-project, /plan-project, /verify-project specs)
@.planning/phases/04-command-handlers-and-project-lifecycle/04-CONTEXT.md
@.planning/phases/04-command-handlers-and-project-lifecycle/04-01-SUMMARY.md
@get-shit-done/knowledge/AGENTS.md
@get-shit-done/knowledge/project-domain.md
@get-shit-done/knowledge/planning-domain.md
@agents/gsd-project-researcher.md
@agents/gsd-planner.md
@agents/gsd-verifier.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /research-project and /plan-project commands with workflows</name>
  <files>commands/research-project.md, commands/plan-project.md, get-shit-done/workflows/research-project.md, get-shit-done/workflows/plan-project.md</files>
  <action>
  1. Create `commands/research-project.md`:
     - `name: research-project`
     - `description: Strategic research — library choices, ecosystem patterns, architectural approaches`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep, Task, WebFetch, WebSearch]`
     - Subagent context per SPEC — spawns `gsd-project-researcher` agent
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/research-project.md</execution_context>`

  2. Create `get-shit-done/workflows/research-project.md`:
     **Prerequisite:** `.planning/project/PROJECT.md` exists. Soft warning if missing.

     **Flow per SPEC section 4 (`/research-project`):**
     a. Read PROJECT.md to understand project scope
     b. Spawn `gsd-project-researcher` agent with `<files_to_read>` block containing:
        - `.planning/project/PROJECT.md`
        - `.planning/CODEBASE.md` (if exists)
        - `get-shit-done/knowledge/project-domain.md`
     c. Agent performs web search + codebase analysis
     d. Agent writes single file: `.planning/project/PROJECT-RESEARCH.md`
     e. Re-run overwrites existing PROJECT-RESEARCH.md per SPEC

     **Output format per SPEC:**
     ```
     # Project Research: [Short name]
     **Domain:** / **Researched:** / **Confidence:**
     ## Summary
     ## Recommended Stack
     ## Architecture Approach
     ## Critical Pitfalls
     ## Open Questions
     ## Sources
     ```

     **Handoff:** Suggest `/discuss-project` or `/plan-project`. Never auto-advance.

  3. Create `commands/plan-project.md`:
     - `name: plan-project`
     - `description: Break project into phases (strategic). Produces PROJECT-PLAN.md.`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep, Task]`
     - Subagent context per SPEC
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/plan-project.md</execution_context>`

  4. Create `get-shit-done/workflows/plan-project.md`:
     **Prerequisite:** `.planning/project/PROJECT.md` exists. Soft warning if missing.

     **Flow per SPEC section 4 (`/plan-project`):**
     a. Read PROJECT.md, CODEBASE.md (if exists), PROJECT-RESEARCH.md (if exists), relevant todos
     b. Spawn planner subagent (use `resolve-model` for model selection) with `<files_to_read>`:
        - `.planning/project/PROJECT.md`
        - `.planning/project/PROJECT-RESEARCH.md` (if exists)
        - `.planning/CODEBASE.md` (if exists)
        - `get-shit-done/knowledge/planning-domain.md`
        - `get-shit-done/knowledge/project-domain.md`
     c. Agent produces PROJECT-PLAN.md (STATE-02 — this replaces ROADMAP/STATE/MILESTONES)

     **PROJECT-PLAN.md format per SPEC (YAML frontmatter + markdown):**
     ```yaml
     ---
     project: [short-name-slug]
     phases: [total count]
     acceptance_criteria_count: [total from PROJECT.md]
     ---
     ```
     ```
     # Project Plan: [Short name]
     ## Phases
     ### Phase 1: [Name]
     **Goal**: [outcome-shaped]
     **Acceptance Criteria**: [AC-1, AC-2]
     **Depends on**: Nothing
     ## Criteria Mapping
     | Criterion | Phase | Description |
     **Coverage**: All [N] acceptance criteria mapped. No orphans.
     ```

     **Handoff per SPEC:** "Planning complete. N phases identified. Phase 1: ... Next: /discuss-phase 1, /research-phase 1, or /plan-phase 1" (SAFE-03).

     **Do NOT create:** ROADMAP.md, STATE.md, MILESTONES.md, REQUIREMENTS.md. PROJECT-PLAN.md is the sole planning artifact (STATE-02).
  </action>
  <verify>
  - `test -f commands/research-project.md && test -f commands/plan-project.md`
  - `grep 'name: research-project' commands/research-project.md`
  - `grep 'name: plan-project' commands/plan-project.md`
  - `test -f get-shit-done/workflows/research-project.md && test -f get-shit-done/workflows/plan-project.md`
  - `grep 'PROJECT-PLAN.md' get-shit-done/workflows/plan-project.md` confirms correct output
  - `grep -c 'ROADMAP\|STATE\.md\|MILESTONES\|REQUIREMENTS' get-shit-done/workflows/plan-project.md` returns 0
  </verify>
  <done>`/research-project` spawns researcher writing PROJECT-RESEARCH.md, `/plan-project` spawns planner writing PROJECT-PLAN.md as the sole planning artifact</done>
</task>

<task type="auto">
  <name>Task 2: Create /verify-project command and workflow</name>
  <files>commands/verify-project.md, get-shit-done/workflows/verify-project.md</files>
  <action>
  1. Create `commands/verify-project.md`:
     - `name: verify-project`
     - `description: Check result against project-level acceptance criteria`
     - `allowed-tools: [Read, Bash, Glob, Grep, Write, Task]`
     - Subagent context per SPEC
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/verify-project.md</execution_context>`

  2. Create `get-shit-done/workflows/verify-project.md`:
     **Prerequisite:** `.planning/project/PROJECT.md` and `.planning/project/PROJECT-SUMMARY.md` should exist (execution has occurred). Soft warning if missing.

     **Flow per SPEC section 4 (`/verify-project`):**
     a. Read PROJECT.md acceptance criteria
     b. Read PROJECT-SUMMARY.md for execution history
     c. Spawn verifier subagent with `<files_to_read>`:
        - `.planning/project/PROJECT.md`
        - `.planning/project/PROJECT-SUMMARY.md`
        - `get-shit-done/knowledge/verification-domain.md`
     d. Agent performs three-layer verification:
        - Diff analysis: `git diff HEAD` — what changed vs what should have
        - Code reasoning: does implementation satisfy each criterion
        - Test suite execution: run relevant tests
     e. Agent writes `.planning/project/PROJECT-VERIFICATION.md` with pass/fail per criterion

     **PROJECT-VERIFICATION.md format per SPEC:**
     Pass/fail per acceptance criterion. On failure: diagnostics including what's wrong, why, where to look (specific files and line numbers).

     **Failure path per SPEC:** Verifier reports and stops. No automated fix loop. Human decides: fix manually, re-run a phase, adjust the plan, or accept as-is.

     **Handoff:** Report verification results. If all pass, suggest committing. If failures exist, list them clearly with diagnostics. Never auto-fix (SAFE-03).
  </action>
  <verify>
  - `test -f commands/verify-project.md`
  - `grep 'name: verify-project' commands/verify-project.md`
  - `test -f get-shit-done/workflows/verify-project.md`
  - Workflow reads PROJECT.md and uses `git diff HEAD`
  - Workflow writes PROJECT-VERIFICATION.md to `.planning/project/`
  </verify>
  <done>`/verify-project` checks execution against acceptance criteria using diff analysis, code reasoning, and test execution; writes PROJECT-VERIFICATION.md with per-criterion pass/fail diagnostics</done>
</task>

</tasks>

<verification>
- [ ] All three commands exist in `commands/` with bare namespace
- [ ] All three workflows exist in `get-shit-done/workflows/`
- [ ] Each command correctly references its workflow via `execution_context`
- [ ] `/plan-project` output is PROJECT-PLAN.md (not ROADMAP.md or STATE.md)
- [ ] No GSD-specific state artifacts (ROADMAP, STATE, MILESTONES, REQUIREMENTS) created
- [ ] Each workflow checks prerequisites with soft warning pattern
- [ ] Handoff messages suggest next steps without auto-advance
</verification>

<success_criteria>
- `/research-project` produces single-file PROJECT-RESEARCH.md via subagent
- `/plan-project` produces PROJECT-PLAN.md as sole planning artifact (no ROADMAP/STATE/MILESTONES)
- `/verify-project` checks results against acceptance criteria with per-criterion diagnostics
- All commands use bare namespace
- All commands check prerequisites with soft warnings
</success_criteria>

<output>
After completion, create `.planning/phases/04-command-handlers-and-project-lifecycle/04-03-SUMMARY.md`
</output>
