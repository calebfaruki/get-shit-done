---
phase: 04-command-handlers-and-project-lifecycle
plan: 04
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - commands/discuss-phase.md
  - commands/research-phase.md
  - commands/plan-phase.md
  - get-shit-done/workflows/discuss-phase.md
  - get-shit-done/workflows/plan-phase.md
  - get-shit-done/workflows/research-phase.md
  - commands/gsd/discuss-phase.md
  - commands/gsd/plan-phase.md
  - commands/gsd/research-phase.md
autonomous: true
requirements: [CMD-08, CMD-09, CMD-10]

must_haves:
  truths:
    - "User can run `/discuss-phase N` to clarify implementation decisions producing PHASE-N-CONTEXT.md"
    - "User can run `/research-phase N` to get tactical research producing PHASE-N-RESEARCH.md with XML-tagged sections"
    - "User can run `/plan-phase N` to produce PHASE-N-PLAN.md with single-commit scope"
    - "All three commands use bare namespace (no `gsd:` prefix)"
    - "Phase artifacts are written to `.planning/project/` with flat `PHASE-N-*.md` naming"
    - "Old `/gsd:discuss-phase`, `/gsd:plan-phase`, `/gsd:research-phase` commands are deleted"
  artifacts:
    - path: "commands/discuss-phase.md"
      provides: "Bare namespace `/discuss-phase` command"
      contains: "name: discuss-phase"
    - path: "commands/research-phase.md"
      provides: "Bare namespace `/research-phase` command"
      contains: "name: research-phase"
    - path: "commands/plan-phase.md"
      provides: "Bare namespace `/plan-phase` command"
      contains: "name: plan-phase"
    - path: "get-shit-done/workflows/plan-phase.md"
      provides: "Phase planning workflow for single-commit scope"
      contains: "PHASE-.*-PLAN.md"
  key_links:
    - from: "get-shit-done/workflows/discuss-phase.md"
      to: ".planning/project/PHASE-N-CONTEXT.md"
      via: "output artifact"
      pattern: "PHASE-.*-CONTEXT"
    - from: "get-shit-done/workflows/research-phase.md"
      to: ".planning/project/PHASE-N-RESEARCH.md"
      via: "output artifact with XML-tagged sections"
      pattern: "PHASE-.*-RESEARCH"
    - from: "get-shit-done/workflows/plan-phase.md"
      to: ".planning/project/PHASE-N-PLAN.md"
      via: "output artifact with YAML frontmatter + XML body"
      pattern: "PHASE-.*-PLAN"
---

<objective>
Modify the three phase-level commands (`/discuss-phase`, `/research-phase`, `/plan-phase`) for bare namespace and SPEC compliance. These commands operate on individual phases within a project.

Purpose: Phase-level commands provide tactical implementation discipline — clarify decisions, research specifics, and plan execution details for each phase.
Output: Three working bare-namespace commands writing to `.planning/project/` with flat naming.
</objective>

<execution_context>
@/Users/calebfaruki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/calebfaruki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@SPEC.md (sections 3, 4 — /discuss-phase, /research-phase, /plan-phase specs)
@.planning/phases/04-command-handlers-and-project-lifecycle/04-CONTEXT.md
@.planning/phases/04-command-handlers-and-project-lifecycle/04-01-SUMMARY.md
@get-shit-done/workflows/discuss-phase.md
@get-shit-done/workflows/plan-phase.md
@get-shit-done/workflows/research-phase.md
@get-shit-done/knowledge/planning-domain.md
@get-shit-done/knowledge/AGENTS.md
@commands/gsd/discuss-phase.md
@commands/gsd/plan-phase.md
@commands/gsd/research-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Modify /discuss-phase and /research-phase for SPEC compliance</name>
  <files>commands/discuss-phase.md, commands/research-phase.md, get-shit-done/workflows/discuss-phase.md, get-shit-done/workflows/research-phase.md, commands/gsd/discuss-phase.md, commands/gsd/research-phase.md</files>
  <action>
  1. Create `commands/discuss-phase.md` (bare namespace):
     - `name: discuss-phase`
     - `description: Clarify implementation decisions for a phase before planning`
     - `argument-hint: "N (phase number)"`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep]`
     - Main conversation context per SPEC
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/discuss-phase.md</execution_context>`

  2. Modify `get-shit-done/workflows/discuss-phase.md`:
     **Prerequisite:** `.planning/project/PROJECT-PLAN.md` exists. Soft warning if missing.

     **Key changes from GSD version:**
     - Output goes to `.planning/project/PHASE-{N}-CONTEXT.md` (not `.planning/phases/` directory)
     - No ROADMAP.md or STATE.md dependencies — reads PROJECT-PLAN.md instead
     - No `gsd-tools.cjs` calls for state management
     - Three-category output per SPEC: Locked Decisions, Deferred Ideas (fed into todos), Discretion Areas
     - Strip any references to wave structure, parallelization, multi-plan concepts

     **Handoff:** Suggest `/research-phase N` or `/plan-phase N`. Never auto-advance.

  3. Create `commands/research-phase.md` (bare namespace):
     - `name: research-phase`
     - `description: Tactical research for a phase — implementation details, gotchas, patterns`
     - `argument-hint: "N (phase number)"`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep, Task, WebFetch, WebSearch]`
     - Subagent context per SPEC
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/research-phase.md</execution_context>`

  4. Modify `get-shit-done/workflows/research-phase.md`:
     **Prerequisite:** `.planning/project/PROJECT-PLAN.md` exists. Soft warning if missing.

     **Key changes from GSD version:**
     - Output: `.planning/project/PHASE-{N}-RESEARCH.md` (not `.planning/phases/` directory)
     - Reads PROJECT-PLAN.md (not ROADMAP.md) for phase context
     - Reads PHASE-{N}-CONTEXT.md if exists (honors locked decisions)
     - XML-tagged sections per SPEC: `<user_constraints>`, `<research_summary>`, `<standard_stack>`, `<implementation_patterns>`, `<common_pitfalls>`, `<open_questions>`, `<sources>`
     - Lighter touch for single-commit scope — less exhaustive than GSD version
     - Re-run overwrites PHASE-{N}-RESEARCH.md per SPEC
     - Strip STATE.md, ROADMAP.md, config.json references

     **Handoff:** Suggest `/plan-phase N`. Never auto-advance.

  5. Delete `commands/gsd/discuss-phase.md` and `commands/gsd/research-phase.md`.
  </action>
  <verify>
  - `test -f commands/discuss-phase.md && test -f commands/research-phase.md`
  - `grep 'name: discuss-phase' commands/discuss-phase.md`
  - `grep 'name: research-phase' commands/research-phase.md`
  - `test ! -f commands/gsd/discuss-phase.md && test ! -f commands/gsd/research-phase.md`
  - `grep '.planning/project/' get-shit-done/workflows/discuss-phase.md` confirms correct output path
  - `grep 'user_constraints' get-shit-done/workflows/research-phase.md` confirms XML-tagged sections
  - No references to ROADMAP.md or STATE.md in workflows
  </verify>
  <done>`/discuss-phase` produces PHASE-N-CONTEXT.md, `/research-phase` produces PHASE-N-RESEARCH.md with XML sections, both use bare namespace and `.planning/project/` output</done>
</task>

<task type="auto">
  <name>Task 2: Modify /plan-phase for single-commit scope and delete old /map command</name>
  <files>commands/plan-phase.md, get-shit-done/workflows/plan-phase.md, commands/gsd/plan-phase.md</files>
  <action>
  1. Create `commands/plan-phase.md` (bare namespace):
     - `name: plan-phase`
     - `description: Produce detailed execution plan for a phase`
     - `argument-hint: "N (phase number)"`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep, Task]`
     - Subagent context per SPEC
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/plan-phase.md</execution_context>`

  2. Modify `get-shit-done/workflows/plan-phase.md`:
     **Prerequisite:** `.planning/project/PROJECT-PLAN.md` exists. Soft warning if missing.

     **Key changes from GSD version for single-commit scope:**
     - Output: `.planning/project/PHASE-{N}-PLAN.md` (flat in project directory)
     - Reads PROJECT-PLAN.md (not ROADMAP.md) for phase context
     - Reads PHASE-{N}-CONTEXT.md and PHASE-{N}-RESEARCH.md if they exist
     - Reads CODEBASE.md for codebase context
     - One plan per phase per CONTEXT decision — no waves, no parallelization, no multi-plan structure
     - No `wave` or `depends_on` in frontmatter per SPEC
     - Spawn planner subagent with `<files_to_read>`:
       - `.planning/project/PROJECT-PLAN.md`
       - `.planning/project/PHASE-{N}-CONTEXT.md` (if exists)
       - `.planning/project/PHASE-{N}-RESEARCH.md` (if exists)
       - `.planning/CODEBASE.md` (if exists)
       - `get-shit-done/knowledge/planning-domain.md`
       - `get-shit-done/knowledge/project-domain.md`

     **PHASE-N-PLAN.md format per SPEC (YAML frontmatter + XML body):**
     ```yaml
     ---
     phase: [N]
     type: execute | tdd
     acceptance_criteria: [AC-1, AC-2]
     files_modified: []
     must_haves:
       truths: []
       artifacts: []
     ---
     ```
     ```xml
     <objective>...</objective>
     <context>@file references</context>
     <tasks>
       <task><name>...</name><files>...</files><action>...</action><verify>...</verify><done>...</done></task>
     </tasks>
     <verification>...</verification>
     ```

     No checkpoint tasks per SPEC — decisions belong in `/discuss-phase`.

     **Handoff:** Suggest `/execute-phase N`. Never auto-advance (SAFE-03).

  3. Delete `commands/gsd/plan-phase.md`.
  </action>
  <verify>
  - `test -f commands/plan-phase.md`
  - `grep 'name: plan-phase' commands/plan-phase.md`
  - `test ! -f commands/gsd/plan-phase.md`
  - `grep '.planning/project/' get-shit-done/workflows/plan-phase.md` confirms correct output path
  - `grep -c 'wave\|depends_on\|parallelization' get-shit-done/workflows/plan-phase.md` returns 0 (no multi-plan concepts)
  - Plan format includes `must_haves` in frontmatter
  </verify>
  <done>`/plan-phase` produces PHASE-N-PLAN.md with single-commit scope — one plan per phase, no waves, no parallelization, no checkpoint tasks, correct YAML + XML format</done>
</task>

</tasks>

<verification>
- [ ] All three commands exist in `commands/` with bare namespace
- [ ] All three old `gsd:*` commands deleted
- [ ] Workflows write to `.planning/project/` (not `.planning/phases/`)
- [ ] No references to ROADMAP.md, STATE.md, config.json
- [ ] `/plan-phase` output has no `wave`, `depends_on`, or parallelization
- [ ] PHASE-N-PLAN.md uses YAML frontmatter + XML body per SPEC
- [ ] PHASE-N-RESEARCH.md uses XML-tagged sections per SPEC
- [ ] PHASE-N-CONTEXT.md uses three-category sections per SPEC
- [ ] Handoff messages suggest next steps without auto-advance
</verification>

<success_criteria>
- `/discuss-phase N` produces three-category PHASE-N-CONTEXT.md
- `/research-phase N` produces XML-tagged PHASE-N-RESEARCH.md
- `/plan-phase N` produces single-plan PHASE-N-PLAN.md (no waves, no parallelization)
- All phase artifacts written to `.planning/project/` with flat naming
- Old gsd:* commands deleted
</success_criteria>

<output>
After completion, create `.planning/phases/04-command-handlers-and-project-lifecycle/04-04-SUMMARY.md`
</output>
