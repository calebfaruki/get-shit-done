---
phase: 04-command-handlers-and-project-lifecycle
plan: 02
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - commands/new-project.md
  - commands/discuss-project.md
  - get-shit-done/workflows/new-project.md
  - get-shit-done/workflows/discuss-project.md
  - commands/gsd/new-project.md
autonomous: true
requirements: [CMD-01, CMD-03, STATE-01, SCOPE-01, SCOPE-02, SCOPE-03, SAFE-03]

must_haves:
  truths:
    - "User can run `/new-project` and have a conversational intake that produces PROJECT.md in `.planning/project/`"
    - "Intake validates scope using greenfield/mechanical/brownfield verifiability heuristics"
    - "Must-have vs nice-to-have split is enforced — nice-to-haves proposed as todos with human confirmation"
    - "If `.planning/project/` already exists, user is warned and must confirm wipe before proceeding"
    - "User can run `/discuss-project` to explore an existing PROJECT.md in main conversation"
    - "After any command completes, human sees next-step suggestion but no auto-advance occurs"
  artifacts:
    - path: "commands/new-project.md"
      provides: "Bare namespace `/new-project` command entry point"
      contains: "name: new-project"
    - path: "commands/discuss-project.md"
      provides: "Bare namespace `/discuss-project` command entry point"
      contains: "name: discuss-project"
    - path: "get-shit-done/workflows/new-project.md"
      provides: "Project intake workflow with scope validation and ephemeral state"
      contains: ".planning/project/"
    - path: "get-shit-done/workflows/discuss-project.md"
      provides: "Deeper exploration workflow for existing PROJECT.md"
      contains: "PROJECT.md"
  key_links:
    - from: "commands/new-project.md"
      to: "get-shit-done/workflows/new-project.md"
      via: "execution_context reference"
      pattern: "workflows/new-project"
    - from: "get-shit-done/workflows/new-project.md"
      to: "get-shit-done/knowledge/project-domain.md"
      via: "required reading for intake methodology"
      pattern: "project-domain"
    - from: "get-shit-done/workflows/new-project.md"
      to: ".planning/project/PROJECT.md"
      via: "output artifact"
      pattern: "PROJECT\\.md"
---

<objective>
Build the project intake command (`/new-project`) and discussion command (`/discuss-project`) that form the entry point to the project lifecycle.

Purpose: `/new-project` is the most leveraged command — it gates everything else. Good intake means good plans, good execution. `/discuss-project` enables deeper exploration after initial intake.
Output: Working `/new-project` that writes PROJECT.md to `.planning/project/`, `/discuss-project` for exploration.
</objective>

<execution_context>
@/Users/calebfaruki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/calebfaruki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@SPEC.md (sections 2, 3, 4 — scope/verifiability, command surface, /new-project and /discuss-project specs)
@.planning/phases/04-command-handlers-and-project-lifecycle/04-CONTEXT.md
@.planning/phases/04-command-handlers-and-project-lifecycle/04-01-SUMMARY.md
@get-shit-done/workflows/new-project.md
@get-shit-done/knowledge/project-domain.md
@get-shit-done/knowledge/AGENTS.md
@commands/gsd/new-project.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite /new-project command and workflow for SPEC compliance</name>
  <files>commands/new-project.md, get-shit-done/workflows/new-project.md, commands/gsd/new-project.md</files>
  <action>
  1. Create `commands/new-project.md` (bare namespace):
     - `name: new-project`
     - `description: Sharpen vague idea into PROJECT.md with acceptance criteria`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep]`
     - No Task tool needed — this runs in main conversation context per SPEC
     - No AskUserQuestion — use native Claude conversation
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/new-project.md</execution_context>`

  2. Rewrite `get-shit-done/workflows/new-project.md` from scratch following SPEC section 4 (`/new-project` spec). The workflow must implement:

     **Input quality gate (hard deflects):**
     - Trivial fix → "This is a quick fix — just ask me directly, no project needed."
     - Vague one-liner → "This isn't clear enough to plan against. Talk it through with me first."

     **Input quality gate (proceed with sharpening):**
     - Moderate input → 3-5 clarifying questions
     - Detailed input → 1-3 clarifying questions

     **Flow (after quality gate):**
     a. Check for existing `.planning/project/` — if exists, warn and require confirmation before wipe (STATE-01). No archive — direct `rm -rf .planning/project/` per CONTEXT decision.
     b. Create `.planning/project/` directory
     c. Check codebase map staleness: read `.planning/CODEBASE.md`, compare stored SHA to current HEAD. If stale, warn and offer to run `/map` inline.
     d. Surface relevant todos from `.planning/todos/` by area tag matching (not semantic/AI judgment) per CONTEXT decision
     e. Conversational intake per SPEC: AI is adversarial in a helpful way — poke holes, surface edge cases, flag scope creep. Efficient sharpener style: 1-2 rounds max, propose acceptance criteria quickly per CONTEXT.
     f. Validate scope using verifiability heuristics from project-domain.md (SCOPE-01, SCOPE-02): greenfield/mechanical/brownfield assessment. If too broad, recommend scoping down and propose deferred items as todos (SCOPE-03). AI proposes todos, human confirms before write per CONTEXT.
     g. Summarize project and proposed acceptance criteria
     h. Human confirms or adjusts
     i. Write PROJECT.md to `.planning/project/PROJECT.md` only after confirmation

     **PROJECT.md format (plain markdown, NO frontmatter per SPEC):**
     ```
     # Project: [Short name]
     ## Problem
     [What needs to happen and why]
     ## Acceptance Criteria
     - [ ] [Criterion 1]
     ## Out of Scope
     - [Deferred to todos if applicable]
     ## Decisions
     - [Key decisions made during intake]
     ```

     **Handoff message:** Suggest next steps (SAFE-03): `/research-project`, `/discuss-project`, or `/plan-project`. Never auto-advance.

     **Required reading for workflow:**
     - `get-shit-done/knowledge/project-domain.md` — intake methodology, scope validation
     - `get-shit-done/knowledge/AGENTS.md` — agent context

     **Remove all GSD-specific patterns:**
     - No `--auto` mode (not in SPEC)
     - No config.json creation
     - No REQUIREMENTS.md creation
     - No ROADMAP.md creation
     - No STATE.md creation
     - No research subagent spawn (separate command now)
     - No `gsd-tools.cjs` calls except `init` if needed for model resolution

  3. Delete `commands/gsd/new-project.md` — no coexistence period.
  </action>
  <verify>
  - `test -f commands/new-project.md` confirms new command exists
  - `grep 'name: new-project' commands/new-project.md` confirms bare namespace
  - `test ! -f commands/gsd/new-project.md` confirms old command deleted
  - `grep '.planning/project/PROJECT.md' get-shit-done/workflows/new-project.md` confirms correct output path
  - `grep -c 'config.json\|ROADMAP\|STATE\.md\|REQUIREMENTS\|MILESTONES' get-shit-done/workflows/new-project.md` returns 0 (no GSD state artifacts)
  - Workflow references project-domain.md for intake methodology
  </verify>
  <done>`/new-project` conducts conversational intake per SPEC, validates scope, enforces must-have/nice-to-have split, writes PROJECT.md to `.planning/project/`, old gsd:new-project deleted</done>
</task>

<task type="auto">
  <name>Task 2: Create /discuss-project command and workflow</name>
  <files>commands/discuss-project.md, get-shit-done/workflows/discuss-project.md</files>
  <action>
  1. Create `commands/discuss-project.md`:
     - `name: discuss-project`
     - `description: Deeper exploration of existing PROJECT.md — gray areas, edge cases, implementation preferences`
     - `allowed-tools: [Read, Bash, Write, Glob, Grep]`
     - Main conversation context per SPEC (conversational, not subagent)
     - Reference workflow: `<execution_context>@~/.claude/get-shit-done/workflows/discuss-project.md</execution_context>`

  2. Create `get-shit-done/workflows/discuss-project.md`:
     **Prerequisite check:** `.planning/project/PROJECT.md` must exist. If missing, warn and offer to run `/new-project` (soft block, not hard error) per CONTEXT decision.

     **Flow per SPEC section 4 (`/discuss-project`):**
     a. Read `.planning/project/PROJECT.md`
     b. Read `.planning/project/PROJECT-RESEARCH.md` if it exists (reference research findings)
     c. Surface relevant todos from `.planning/todos/`
     d. Conversational exploration: gray areas, edge cases, implementation preferences
     e. After discussion, summarize proposed changes to PROJECT.md
     f. Human confirms before rewrite
     g. If `.planning/project/PROJECT-PLAN.md` already exists, warn that changes may invalidate the plan — human decides whether to re-run `/plan-project`

     **Handoff message:** Suggest next steps: `/research-project`, `/plan-project`, or continue discussing. Never auto-advance (SAFE-03).

     **Required reading:** `get-shit-done/knowledge/project-domain.md`
  </action>
  <verify>
  - `test -f commands/discuss-project.md` confirms command exists
  - `grep 'name: discuss-project' commands/discuss-project.md` confirms bare namespace
  - `test -f get-shit-done/workflows/discuss-project.md` confirms workflow exists
  - Workflow checks for PROJECT.md prerequisite
  - Workflow warns about plan invalidation if PROJECT-PLAN.md exists
  </verify>
  <done>`/discuss-project` enables deeper exploration of existing PROJECT.md, warns about plan invalidation, follows soft prerequisite pattern, produces updated PROJECT.md on confirmation</done>
</task>

</tasks>

<verification>
- [ ] `commands/new-project.md` exists with `name: new-project`
- [ ] `commands/discuss-project.md` exists with `name: discuss-project`
- [ ] `commands/gsd/new-project.md` does not exist
- [ ] Workflow writes PROJECT.md to `.planning/project/PROJECT.md` (not `.planning/PROJECT.md`)
- [ ] Workflow performs scope validation using verifiability heuristics
- [ ] Workflow handles ephemeral state wipe with human confirmation
- [ ] No GSD-specific state files (config.json, ROADMAP.md, STATE.md, REQUIREMENTS.md) referenced
- [ ] Handoff messages suggest next steps without auto-advance
</verification>

<success_criteria>
- `/new-project` conducts proper intake and writes PROJECT.md to `.planning/project/`
- `/discuss-project` explores existing PROJECT.md and warns about plan invalidation
- Scope validation uses greenfield/mechanical/brownfield heuristics
- Must-have/nice-to-have split enforced with todo proposals
- Ephemeral state wipe requires human confirmation
- Human drives all transitions
</success_criteria>

<output>
After completion, create `.planning/phases/04-command-handlers-and-project-lifecycle/04-02-SUMMARY.md`
</output>
