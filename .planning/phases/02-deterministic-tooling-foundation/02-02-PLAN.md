---
phase: 02-deterministic-tooling-foundation
plan: 02
type: tdd
wave: 2
depends_on: [02-01]
files_modified:
  - get-shit-done/bin/lib/toolkit.cjs
  - tests/toolkit.test.cjs
autonomous: true
requirements: [TOOL-05]

must_haves:
  truths:
    - "createTodo creates a markdown file in .planning/todos/ with YAML frontmatter"
    - "createTodo slugifies the title for the filename"
    - "createTodo appends a number to resolve filename collisions"
    - "listTodos returns all todo files with parsed frontmatter"
    - "listTodos filters by area when area parameter is provided"
    - "completeTodo deletes the todo file from disk"
    - "deleteTodo deletes the todo file from disk"
  artifacts:
    - path: "get-shit-done/bin/lib/toolkit.cjs"
      provides: "Todo CRUD functions added to existing toolkit"
      exports: [createTodo, listTodos, completeTodo, deleteTodo]
    - path: "tests/toolkit.test.cjs"
      provides: "TDD tests for todo CRUD appended to existing test file"
      min_lines: 250
  key_links:
    - from: "get-shit-done/bin/lib/toolkit.cjs (createTodo)"
      to: "get-shit-done/bin/lib/toolkit.cjs (atomicWrite)"
      via: "createTodo uses atomicWrite for crash-safe file creation"
      pattern: "atomicWrite"
    - from: "get-shit-done/bin/lib/toolkit.cjs (listTodos)"
      to: ".planning/todos/"
      via: "reads all .md files from todos directory"
      pattern: "\\.planning.*todos"
---

<objective>
Add todo CRUD operations to the toolkit library: create, list, complete, and delete todos stored as individual markdown files with YAML frontmatter.

Purpose: Agents and commands need a deterministic way to manage parking lot items without implementing file management themselves. Todo files are the lightweight state mechanism for deferred work.

Output: Four new exported functions in `toolkit.cjs` and comprehensive tests in `toolkit.test.cjs`.
</objective>

<execution_context>
@/Users/calebfaruki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/calebfaruki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-deterministic-tooling-foundation/02-CONTEXT.md
@.planning/phases/02-deterministic-tooling-foundation/02-RESEARCH.md
@.planning/phases/02-deterministic-tooling-foundation/02-01-SUMMARY.md
@get-shit-done/bin/lib/toolkit.cjs
@tests/toolkit.test.cjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: RED — Write failing tests for todo CRUD operations</name>
  <files>tests/toolkit.test.cjs</files>
  <action>
Append new test suites to the existing `tests/toolkit.test.cjs` file. Use the same temp directory pattern from existing tests.

**createTodo(cwd, title, area, body):**
- Creates file in `.planning/todos/` directory
- Filename is slugified title: "Add caching to API" → `add-caching-to-api.md`
- Returns `{success: true, filename, path: relativePath}`
- File contains YAML frontmatter with `area` and `created` (YYYY-MM-DD format)
- File contains markdown body after frontmatter
- Area defaults to 'general' when not provided
- Creates `.planning/todos/` directory if it doesn't exist
- Collision handling: if `add-caching-to-api.md` exists, creates `add-caching-to-api-2.md`
- Second collision creates `add-caching-to-api-3.md`

**listTodos(cwd):**
- Returns `{count: N, todos: [...]}` with all todo files
- Each todo in array has: `{filename, title, area, created, body, path}`
- Title is extracted from frontmatter or derived from filename
- Returns `{count: 0, todos: []}` for empty or nonexistent todos directory
- Area filter: `listTodos(cwd, 'api')` returns only todos with `area: api`

**completeTodo(cwd, filename):**
- Deletes the file from `.planning/todos/`
- Returns `{success: true, deleted: filename}`
- Returns `{success: false, error: string}` when file doesn't exist

**deleteTodo(cwd, filename):**
- Same behavior as completeTodo (alias — both delete the file, git history preserves it)
- Returns `{success: true, deleted: filename}`
- Returns `{success: false, error: string}` when file doesn't exist

Run `node --test tests/toolkit.test.cjs` — new todo tests must FAIL (RED). Existing toolkit tests from plan 01 must still PASS.
  </action>
  <verify>Run `node --test tests/toolkit.test.cjs`. Todo CRUD tests fail. Core toolkit tests from plan 01 pass.</verify>
  <done>All todo CRUD test cases written and failing. Existing core toolkit tests unaffected.</done>
</task>

<task type="auto">
  <name>Task 2: GREEN — Implement todo CRUD in toolkit.cjs</name>
  <files>get-shit-done/bin/lib/toolkit.cjs</files>
  <action>
Add four functions to `get-shit-done/bin/lib/toolkit.cjs`. Use the existing `atomicWrite` function from plan 01 for file creation.

**createTodo(cwd, title, area, body):**
- Slugify title: `title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '')`
- Target dir: `path.join(cwd, '.planning', 'todos')`
- Create dir if not exists: `fs.mkdirSync(todosDir, {recursive: true})`
- Collision detection: check if `${slug}.md` exists, increment counter (`${slug}-${counter}.md`)
- Build content: YAML frontmatter with `area` (default 'general') and `created` (today's date YYYY-MM-DD), then blank line, then body
- Use `atomicWrite(todoPath, content)` to write
- Return `{success: true, filename, path: relative path from cwd}`

**listTodos(cwd, area):**
- Read all `.md` files from `.planning/todos/`
- For each file: extract frontmatter (area, created), extract body (content after `---\n...\n---\n`)
- Derive title from filename: strip `.md`, replace hyphens with spaces, title case
- If area parameter provided, filter by matching area
- Return `{count, todos}` — gracefully handle missing directory (return empty)

**completeTodo(cwd, filename):**
- Ensure filename ends with `.md`
- `fs.unlinkSync(path.join(cwd, '.planning', 'todos', filename))`
- Return `{success: true, deleted: filename}` or `{success: false, error}`

**deleteTodo(cwd, filename):**
- Identical to completeTodo (semantic alias per user decision: completing = deleting)

Add all four to `module.exports`.

Run `node --test tests/toolkit.test.cjs` — ALL tests pass (GREEN). Also run `node --test tests/deletion-safety.test.cjs` for no regressions.
  </action>
  <verify>Run `node --test tests/toolkit.test.cjs` — all tests pass. Run `node --test tests/deletion-safety.test.cjs` — no regressions.</verify>
  <done>All todo CRUD tests pass. toolkit.cjs exports: createTodo, listTodos, completeTodo, deleteTodo (in addition to plan 01 exports). No regressions in deletion-safety tests.</done>
</task>

</tasks>

<verification>
1. `node --test tests/toolkit.test.cjs` — all tests pass (core + todo)
2. `node --test tests/deletion-safety.test.cjs` — no regressions
3. `node -e "const t = require('./get-shit-done/bin/lib/toolkit.cjs'); console.log(Object.keys(t))"` — lists all 11 exports (7 core + 4 todo)
4. Create a todo manually and verify file format matches spec (YAML frontmatter with area + created, markdown body)
5. Verify collision handling by creating two todos with the same title
</verification>

<success_criteria>
- createTodo produces correctly formatted markdown files with YAML frontmatter
- listTodos reads and parses all todo files, supports area filtering
- completeTodo and deleteTodo remove files from disk
- Filename collision resolution works (appends -2, -3, etc.)
- All functions use atomicWrite for crash safety
- All tests pass, no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/02-deterministic-tooling-foundation/02-02-SUMMARY.md`
</output>
